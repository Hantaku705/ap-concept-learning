module.exports=[43285,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/dynamic-access-async-storage.external.js",()=>require("next/dist/server/app-render/dynamic-access-async-storage.external.js"))},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},9270,(a,b,c)=>{"use strict";b.exports=a.r(97877).vendored.contexts.AppRouterContext},36313,(a,b,c)=>{"use strict";b.exports=a.r(97877).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(97877).vendored.contexts.ServerInsertedHtml},97877,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(97877).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(97877).vendored["react-ssr"].React},35112,(a,b,c)=>{"use strict";b.exports=a.r(97877).vendored["react-ssr"].ReactDOM},51234,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"HandleISRError",{enumerable:!0,get:function(){return e}});let d=a.r(56704).workAsyncStorage;function e({error:a}){if(d){let b=d.getStore();if(b?.isStaticGeneration)throw a&&console.error(a),a}return null}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},40622,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return h}});let d=a.r(87924),e=a.r(51234),f={fontFamily:'system-ui,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji"',height:"100vh",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},g={fontSize:"14px",fontWeight:400,lineHeight:"28px",margin:"0 8px"},h=function({error:a}){let b=a?.digest;return(0,d.jsxs)("html",{id:"__next_error__",children:[(0,d.jsx)("head",{}),(0,d.jsxs)("body",{children:[(0,d.jsx)(e.HandleISRError,{error:a}),(0,d.jsx)("div",{style:f,children:(0,d.jsxs)("div",{children:[(0,d.jsxs)("h2",{style:g,children:["Application error: a ",b?"server":"client","-side exception has occurred while loading ",window.location.hostname," (see the"," ",b?"server logs":"browser console"," for more information)."]}),b?(0,d.jsx)("p",{style:g,children:`Digest: ${b}`}):null]})})]})]})};("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},11642,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d=(0,c.createContext)(void 0),e="subscription_tracker_auth";function f({children:a}){let[f,g]=(0,c.useState)({isAuthenticated:!1,isLoading:!0,tokens:null,userEmail:null,error:null});(0,c.useEffect)(()=>{let a=localStorage.getItem(e);if(a)try{let{tokens:b,userEmail:c}=JSON.parse(a);if(b&&b.expiresAt>Date.now())return void g({isAuthenticated:!0,isLoading:!1,tokens:b,userEmail:c,error:null})}catch(a){console.error("Failed to parse auth from storage",a)}g(a=>({...a,isLoading:!1}))},[]);let h=(0,c.useCallback)(()=>{window.location.href="/api/auth/login"},[]),i=(0,c.useCallback)(()=>{localStorage.removeItem(e),g({isAuthenticated:!1,isLoading:!1,tokens:null,userEmail:null,error:null})},[]),j=(0,c.useCallback)((a,b)=>{localStorage.setItem(e,JSON.stringify({tokens:a,userEmail:b})),g({isAuthenticated:!0,isLoading:!1,tokens:a,userEmail:b,error:null})},[]);return(0,b.jsx)(d.Provider,{value:{...f,login:h,logout:i,setTokens:j},children:a})}function g(){let a=(0,c.useContext)(d);if(void 0===a)throw Error("useAuth must be used within an AuthProvider");return a}a.s(["AuthProvider",()=>f,"useAuth",()=>g])},73480,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(11642);let e=(0,c.createContext)(void 0),f="subscription_tracker_data",g=a=>`subscription_data_${a}`;function h({children:a}){let[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(!0),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(null),{tokens:t,userEmail:u,isLoading:v}=(0,d.useAuth)();(0,c.useEffect)(()=>{if(v)return;if(!u){i([]),q(null),k(!1);return}let a=g(u),b=localStorage.getItem(f),c=localStorage.getItem(a);if(b&&!c)try{let c=JSON.parse(b);localStorage.setItem(a,b),localStorage.removeItem(f),console.log(`Migrated subscription data to user-specific key: ${a}`),i(c.subscriptions||[]),q(c.lastScanAt||null)}catch(a){console.error("Failed to migrate legacy data",a)}else{let b=localStorage.getItem(a);if(b)try{let{subscriptions:a,lastScanAt:c}=JSON.parse(b);i(a||[]),q(c||null)}catch(a){console.error("Failed to parse subscriptions from storage",a)}}k(!1)},[u,v]),(0,c.useEffect)(()=>{if(!j&&u){let a=g(u);localStorage.setItem(a,JSON.stringify({subscriptions:h,lastScanAt:p}))}},[h,p,j,u]);let w=(0,c.useCallback)(a=>{let b=new Date().toISOString(),c={...a,id:crypto.randomUUID(),createdAt:b,updatedAt:b};i(a=>[...a,c])},[]),x=(0,c.useCallback)((a,b)=>{i(c=>c.map(c=>c.id===a?{...c,...b,updatedAt:new Date().toISOString()}:c))},[]),y=(0,c.useCallback)(a=>{i(b=>b.filter(b=>b.id!==a))},[]),z=(0,c.useCallback)(async a=>{if(t?.accessToken){m(!0),o({current:0,total:0});try{let b=await fetch("/api/gmail/scan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:t.accessToken,existingSubscriptions:h,periodDays:a})});if(!b.ok)throw Error("Scan failed");let c=await b.json();i(c.subscriptions),q(new Date().toISOString()),s(c.stats)}catch(a){console.error("Scan error:",a)}finally{m(!1),o(null)}}},[t,h]),A=(0,c.useCallback)(()=>h.filter(a=>"active"===a.status).reduce((a,b)=>"yearly"===b.billingCycle?a+b.amount/12:"quarterly"===b.billingCycle?a+b.amount/3:"weekly"===b.billingCycle?a+4*b.amount:a+b.amount,0),[h]),B=(0,c.useCallback)(()=>{let a={};return h.filter(a=>"active"===a.status).forEach(b=>{a[b.category]||(a[b.category]=[]),a[b.category].push(b)}),a},[h]),C=(0,c.useCallback)(a=>{let b=new Date,c=new Date;return c.setDate(c.getDate()+a),h.filter(a=>"active"===a.status).filter(a=>{let d=new Date(a.nextBillingDate);return d>=b&&d<=c}).sort((a,b)=>new Date(a.nextBillingDate).getTime()-new Date(b.nextBillingDate).getTime())},[h]),D=(0,c.useCallback)(()=>h.filter(a=>"active"===a.status),[h]);return(0,b.jsx)(e.Provider,{value:{subscriptions:h,isLoading:j,isScanning:l,scanProgress:n,lastScanAt:p,lastScanStats:r,addSubscription:w,updateSubscription:x,deleteSubscription:y,scanEmails:z,getTotalMonthlyAmount:A,getByCategory:B,getUpcomingRenewals:C,getActiveSubscriptions:D},children:a})}function i(){let a=(0,c.useContext)(e);if(void 0===a)throw Error("useSubscriptions must be used within a SubscriptionProvider");return a}a.s(["SubscriptionProvider",()=>h,"useSubscriptions",()=>i])},40491,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(11642);let e=(0,c.createContext)(null),f="cached_cancellation_guides",g=a=>`cancellation_guides_${a}`;function h({children:a}){let[h,i]=(0,c.useState)({}),[j,k]=(0,c.useState)(new Set),[l,m]=(0,c.useState)(!1),{userEmail:n,isLoading:o}=(0,d.useAuth)();(0,c.useEffect)(()=>{if(o)return;if(!n){i({}),m(!0);return}let a=g(n),b=localStorage.getItem(f),c=localStorage.getItem(a);if(b&&!c)try{localStorage.setItem(a,b),localStorage.removeItem(f),console.log(`Migrated cancellation guides to user-specific key: ${a}`),i(JSON.parse(b))}catch(a){console.error("Failed to migrate legacy guides:",a)}else try{let b=localStorage.getItem(a);b&&i(JSON.parse(b))}catch(a){console.error("Failed to load cached guides:",a)}m(!0)},[n,o]),(0,c.useEffect)(()=>{if(l&&n&&Object.keys(h).length>0)try{let a=g(n);localStorage.setItem(a,JSON.stringify(h))}catch(a){console.error("Failed to save cached guides:",a)}},[h,n,l]);let p=(0,c.useCallback)(async a=>{if(h[a])return h[a];if(j.has(a))return null;k(b=>new Set(b).add(a));try{let b=await fetch("/api/cancellation-guide",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({serviceName:a})});if(!b.ok){let a=await b.json();throw Error(a.error||"取得に失敗しました")}let{guide:c}=await b.json();return i(b=>({...b,[a]:c})),c}catch(a){throw console.error("Failed to fetch guide:",a),a}finally{k(b=>{let c=new Set(b);return c.delete(a),c})}},[h,j]),q=(0,c.useCallback)(a=>h[a],[h]),r=(0,c.useCallback)(a=>j.has(a),[j]);return(0,b.jsx)(e.Provider,{value:{cachedGuides:h,loadingServices:j,fetchGuide:p,getGuide:q,isLoading:r},children:a})}function i(){let a=(0,c.useContext)(e);if(!a)throw Error("useCancellationGuide must be used within CancellationGuideProvider");return a}a.s(["CancellationGuideProvider",()=>h,"useCancellationGuide",()=>i])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__16a653a0._.js.map