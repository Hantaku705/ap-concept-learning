module.exports=[88521,e=>{"use strict";var t=e.i(314),n=e.i(65597);function s(e){if(!e)return"newer_than:1y";let t=new Date,n=new Date(t);n.setDate(t.getDate()-e);let s=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),a=String(n.getDate()).padStart(2,"0");return`after:${s}/${o}/${a}`}async function o(e){let s=(0,n.getOAuth2Client)();return s.setCredentials({access_token:e}),t.google.gmail({version:"v1",auth:s})}async function a(e,t,n=100){return(await e.users.messages.list({userId:"me",q:t,maxResults:n})).data.messages||[]}async function i(e,t){try{let n=(await e.users.messages.get({userId:"me",id:t,format:"full"})).data,s=n.payload?.headers||[],o=s.find(e=>e.name?.toLowerCase()==="subject")?.value||"",a=s.find(e=>e.name?.toLowerCase()==="from")?.value||"",i=s.find(e=>e.name?.toLowerCase()==="date")?.value||"",r=function e(t){let n=[];for(let s of t)s.filename&&s.filename.length>0&&n.push({filename:s.filename,mimeType:s.mimeType||"application/octet-stream",attachmentId:s.body?.attachmentId||void 0}),s.parts&&n.push(...e(s.parts));return n}(n.payload?.parts||[]),l=r.some(e=>"application/pdf"===e.mimeType||e.filename.toLowerCase().endsWith(".pdf")),c="";if(n.payload?.body?.data)c=Buffer.from(n.payload.body.data,"base64").toString("utf-8");else if(n.payload?.parts){let e=function e(t){for(let n of t){if("text/plain"===n.mimeType||"text/html"===n.mimeType)return n;if(n.parts){let t=e(n.parts);if(t)return t}}return null}(n.payload.parts);e?.body?.data&&(c=Buffer.from(e.body.data,"base64").toString("utf-8"))}return c=c.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),{id:t,subject:o,from:a,date:i,body:c.slice(0,5e3),hasPdfAttachment:l,attachments:r}}catch(e){return console.error("Failed to get email content:",t,e),null}}async function r(e,t,n){let r=await o(e),l=await a(r,["has:attachment filename:pdf subject:(請求 OR 領収 OR お支払い OR invoice OR receipt OR 明細 OR ご利用)",s(t)].join(" "),50),c=await a(r,["subject:(請求 OR 領収 OR お支払い OR invoice OR receipt OR billing OR subscription OR サブスクリプション OR 月額) from:(-no-reply@accounts.google.com)",s(t)].join(" "),50),m=new Set,p=[];for(let e of l)e.id&&!m.has(e.id)&&(m.add(e.id),p.push(e));for(let e of c)e.id&&!m.has(e.id)&&(m.add(e.id),p.push(e));let d=[];for(let e=0;e<p.length;e++){let t=p[e];if(t.id){let e=await i(r,t.id);e&&d.push(e)}n?.(e+1,p.length)}return d.sort((e,t)=>e.hasPdfAttachment&&!t.hasPdfAttachment?-1:!e.hasPdfAttachment&&t.hasPdfAttachment?1:0),d}e.s(["createGmailClient",()=>o,"getEmailContent",()=>i,"scanForSubscriptions",()=>r,"searchEmails",()=>a])},22172,e=>{"use strict";var t=e.i(54799);let n={randomUUID:t.randomUUID},s=new Uint8Array(256),o=s.length,a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));let i=function(e,i,r){if(n.randomUUID&&!i&&!e)return n.randomUUID();let l=(e=e||{}).random??e.rng?.()??(o>s.length-16&&((0,t.randomFillSync)(s),o=0),s.slice(o,o+=16));if(l.length<16)throw Error("Random bytes length must be >= 16");if(l[6]=15&l[6]|64,l[8]=63&l[8]|128,i){if((r=r||0)<0||r+16>i.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)i[r+e]=l[e];return i}return function(e,t=0){return(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase()}(l)},r=[{serviceName:"Netflix",senderPatterns:["@netflix.com","@mailer.netflix.com"],subjectPatterns:["Netflix.*請求","Netflix.*領収","お支払い.*Netflix","Netflix.*payment","Netflix.*receipt"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円","\\$([\\d.]+)"],category:"streaming",cancellationUrl:"https://www.netflix.com/cancelplan",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/netflix.svg"},{serviceName:"Amazon Prime",senderPatterns:["@amazon.co.jp","@amazon.com"],subjectPatterns:["Prime.*会費","Amazonプライム.*お支払い","Prime Video","Amazon Prime.*payment","プライム会費"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円"],category:"streaming",cancellationUrl:"https://www.amazon.co.jp/gp/primecentral",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/amazonprime.svg"},{serviceName:"Spotify",senderPatterns:["@spotify.com"],subjectPatterns:["Spotify.*領収","Spotify Premium","お支払い.*Spotify","Spotify.*receipt"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円","\\$([\\d.]+)"],category:"streaming",cancellationUrl:"https://support.spotify.com/jp/article/cancel-premium/",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/spotify.svg"},{serviceName:"YouTube Premium",senderPatterns:["@youtube.com","@google.com","googleplay"],subjectPatterns:["YouTube Premium.*請求","YouTube.*お支払い","Google Play.*YouTube","YouTube Premium.*receipt"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円"],category:"streaming",cancellationUrl:"https://support.google.com/youtube/answer/6308278",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/youtube.svg"},{serviceName:"Apple Music",senderPatterns:["@apple.com","@email.apple.com"],subjectPatterns:["Apple Music.*領収","Apple.*サブスクリプション","App Store.*領収","Apple Music.*receipt"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円"],category:"streaming",cancellationUrl:"https://support.apple.com/ja-jp/HT202039",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/applemusic.svg"},{serviceName:"Disney+",senderPatterns:["@disney","@disneyplus.com"],subjectPatterns:["Disney\\+.*請求","Disney Plus.*payment","ディズニー.*お支払い"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円","\\$([\\d.]+)"],category:"streaming",cancellationUrl:"https://www.disneyplus.com/account",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/disneyplus.svg"},{serviceName:"U-NEXT",senderPatterns:["@unext.jp","@u-next.jp"],subjectPatterns:["U-NEXT.*請求","ユーネクスト.*お支払い","U-NEXT.*月額"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円"],category:"streaming",cancellationUrl:"https://help.unext.jp/guide/detail/how-to-cancel",logoUrl:""},{serviceName:"Adobe Creative Cloud",senderPatterns:["@adobe.com","@adobemail.com"],subjectPatterns:["Adobe.*請求","Creative Cloud.*お支払い","Adobe.*領収","Adobe.*invoice"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円","\\$([\\d.]+)"],category:"software",cancellationUrl:"https://helpx.adobe.com/jp/manage-account/using/cancel-subscription.html",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/adobe.svg"},{serviceName:"Microsoft 365",senderPatterns:["@microsoft.com","@email.microsoft.com"],subjectPatterns:["Microsoft 365.*請求","Office.*サブスクリプション","Microsoft.*お支払い","Microsoft 365.*renewal"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円"],category:"software",cancellationUrl:"https://support.microsoft.com/ja-jp/office/",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/microsoft.svg"},{serviceName:"Notion",senderPatterns:["@notion.so","@makenotion.com"],subjectPatterns:["Notion.*invoice","Notion.*receipt","Notion.*billing","Notion.*請求"],amountPatterns:["\\$([\\d.]+)","¥([\\d,]+)"],category:"software",cancellationUrl:"https://www.notion.so/help/billing-and-payment",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/notion.svg"},{serviceName:"Slack",senderPatterns:["@slack.com"],subjectPatterns:["Slack.*invoice","Slack.*receipt","Slack.*請求"],amountPatterns:["\\$([\\d.]+)","¥([\\d,]+)"],category:"software",cancellationUrl:"https://slack.com/help/articles/218915077",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/slack.svg"},{serviceName:"ChatGPT Plus",senderPatterns:["@openai.com"],subjectPatterns:["ChatGPT.*receipt","OpenAI.*payment","ChatGPT Plus","OpenAI.*invoice"],amountPatterns:["\\$([\\d.]+)","¥([\\d,]+)"],category:"software",cancellationUrl:"https://help.openai.com/en/articles/8546615",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/openai.svg"},{serviceName:"GitHub",senderPatterns:["@github.com"],subjectPatterns:["GitHub.*receipt","GitHub.*payment","GitHub Pro","GitHub.*invoice"],amountPatterns:["\\$([\\d.]+)","¥([\\d,]+)"],category:"software",cancellationUrl:"https://docs.github.com/en/billing/managing-your-github-billing-settings",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/github.svg"},{serviceName:"Google One",senderPatterns:["@google.com","@googleplay.com"],subjectPatterns:["Google One.*請求","Google ストレージ.*お支払い","Google One.*領収","Google One.*receipt"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円"],category:"cloud",cancellationUrl:"https://one.google.com/settings",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/google.svg"},{serviceName:"iCloud+",senderPatterns:["@apple.com","@email.apple.com"],subjectPatterns:["iCloud.*領収","iCloud\\+.*お支払い","iCloud ストレージ","iCloud.*receipt"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円"],category:"cloud",cancellationUrl:"https://support.apple.com/ja-jp/HT207594",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/icloud.svg"},{serviceName:"Dropbox",senderPatterns:["@dropbox.com","@dropboxmail.com"],subjectPatterns:["Dropbox.*receipt","Dropbox.*invoice","Dropbox.*領収","Dropbox Plus","Dropbox Professional"],amountPatterns:["\\$([\\d.]+)","¥([\\d,]+)"],category:"cloud",cancellationUrl:"https://help.dropbox.com/ja-jp/accounts-billing/cancellations-refunds/cancel",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/dropbox.svg"},{serviceName:"PlayStation Plus",senderPatterns:["@playstation.com","@sony.com","playstation"],subjectPatterns:["PlayStation Plus.*請求","PS Plus.*お支払い","PlayStation.*領収","PlayStation Plus.*receipt"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円"],category:"gaming",cancellationUrl:"https://www.playstation.com/ja-jp/support/store/cancel-ps-store-subscription/",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/playstation.svg"},{serviceName:"Nintendo Switch Online",senderPatterns:["@nintendo.com","@nintendo.co.jp"],subjectPatterns:["Nintendo Switch Online.*請求","Nintendo.*お支払い","ニンテンドー.*月額"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円"],category:"gaming",cancellationUrl:"https://www.nintendo.co.jp/support/switch/online/automatic_renewal.html",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/nintendoswitch.svg"},{serviceName:"Xbox Game Pass",senderPatterns:["@xbox.com","@microsoft.com"],subjectPatterns:["Xbox Game Pass.*請求","Game Pass.*お支払い","Xbox.*サブスクリプション","Xbox Game Pass.*receipt"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円"],category:"gaming",cancellationUrl:"https://support.xbox.com/ja-JP/help/subscriptions-billing/manage-subscriptions/cancel-subscription",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/xbox.svg"},{serviceName:"Apple Fitness+",senderPatterns:["@apple.com"],subjectPatterns:["Fitness\\+.*領収","Apple Fitness.*お支払い","Fitness\\+.*receipt"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円"],category:"fitness",cancellationUrl:"https://support.apple.com/ja-jp/HT202039",logoUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/apple.svg"},{serviceName:"SNS侍",senderPatterns:["sns-samurai","snssamurai","sns侍","snsmkt"],subjectPatterns:["SNS侍.*請求","SNS侍.*ご利用","請求.*SNS侍",".*SNS侍.*","ご請求.*侍"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円","合計.*?([\\d,]+)円","請求金額.*?([\\d,]+)"],category:"software",cancellationUrl:"",logoUrl:""},{serviceName:"日経電子版",senderPatterns:["@nikkei.com","nikkei"],subjectPatterns:["日経電子版.*請求","日経.*お支払い","日本経済新聞.*月額"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円"],category:"news",cancellationUrl:"https://www.nikkei.com/help/subscribe/cancel/",logoUrl:""},{serviceName:"PDF Invoice",senderPatterns:[],subjectPatterns:[".*請求書",".*領収書",".*明細書",".*ご利用明細",".*invoice",".*receipt",".*statement",".*お支払い.*確認",".*ご請求",".*決済.*完了"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円","\\$([\\d.]+)","€([\\d.]+)","([\\d,]+)\\s*円"],category:"other",isPdfPattern:!0},{serviceName:"Embedded Invoice",senderPatterns:[],subjectPatterns:[".*請求書.*",".*ご請求.*",".*請求のお知らせ.*",".*ご利用料金.*",".*お支払い.*のお知らせ",".*料金.*確定",".*月額.*請求",".*利用料.*お知らせ"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円","\\$([\\d.]+)","€([\\d.]+)","合計.*?([\\d,]+)","請求金額.*?([\\d,]+)"],category:"other",isEmbeddedInvoice:!0},{serviceName:"Unknown Subscription",senderPatterns:[],subjectPatterns:[".*サブスクリプション.*請求",".*月額.*お支払い",".*定期購入.*領収",".*subscription.*invoice",".*monthly.*billing",".*recurring.*payment",".*自動更新.*お知らせ"],amountPatterns:["¥([\\d,]+)","([\\d,]+)円","\\$([\\d.]+)","€([\\d.]+)"],category:"other"}];function l(e){let t=e.from.toLowerCase();e.subject.toLowerCase();let n=e.hasPdfAttachment||!1;for(let s of r){if(s.isPdfPattern&&!n)continue;let o=0===s.senderPatterns.length||s.senderPatterns.some(e=>t.includes(e.toLowerCase()));if(!o&&s.senderPatterns.length>0)continue;let a=s.subjectPatterns.some(t=>RegExp(t,"i").test(e.subject));if(!a)continue;let r=c(e.body,s.amountPatterns)||c(e.subject,s.amountPatterns),l=function(e){try{let t=new Date(e);if(!isNaN(t.getTime()))return t.toISOString().split("T")[0]}catch{}return new Date().toISOString().split("T")[0]}(e.date),m=.5;o&&s.senderPatterns.length>0&&(m+=.3),a&&(m+=.1),r&&(m+=.1),n&&(m+=.2);let p=new Date().toISOString(),d=s.serviceName;("Unknown Subscription"===d||"PDF Invoice"===d||"Embedded Invoice"===d)&&(d=function(e,t,n){let s=e.match(/^([^<]+)</);if(s){let e=s[1].trim();if(e.length>1&&e.length<50)return e}let o=e.match(/@([^.]+)\./);if(o){let e=o[1];if(!["gmail","yahoo","outlook","hotmail","noreply","no-reply","mail"].includes(e.toLowerCase()))return e.charAt(0).toUpperCase()+e.slice(1)}if(n){for(let e of n)if(e.filename.toLowerCase().endsWith(".pdf")){let t=e.filename.replace(/\.pdf$/i,"").replace(/[_-]?\d{4,}/g,"").replace(/[_-]/g," ").trim();if(t.length>2&&t.length<50)return t}}let a=t.split(/[\s　]+/).filter(e=>e.length>2);return a.length>0?a[0]:"Unknown Service"}(e.from,e.subject,e.attachments));let u=e.attachments?.filter(e=>e.filename.toLowerCase().endsWith(".pdf"))||[],g=u.map(e=>e.filename),f=u.map(e=>e.attachmentId).filter(e=>!!e);return{subscription:{id:i(),serviceName:d,category:s.category,amount:r||0,currency:"JPY",billingCycle:"monthly",nextBillingDate:function(e){let t=new Date(e);return t.setMonth(t.getMonth()+1),t.toISOString().split("T")[0]}(l),startDate:l,status:"active",source:"gmail",email:e.from,senderEmail:e.from,logoUrl:s.logoUrl,cancellationUrl:s.cancellationUrl,lastDetectedAt:p,hasPdfAttachment:n,pdfFilenames:g.length>0?g:void 0,emailSubject:e.subject,messageId:e.id,attachmentIds:f.length>0?f:void 0,emailBody:e.body.slice(0,500),createdAt:p,updatedAt:p},confidence:m,matchedPattern:s,rawEmail:e}}return null}function c(e,t){for(let n of t){let t=RegExp(n,"g");for(let n of e.matchAll(t))if(n[1]){let e=parseFloat(n[1].replace(/,/g,""));if(!isNaN(e)&&e>0&&e<1e6)return e}}return null}function m(e,t){let n=[...e],s=0,o=0,a=new Map;for(let e of t){let t=e.subscription.serviceName?.toLowerCase()||"",n=a.get(t);(!n||e.rawEmail.date>n.rawEmail.date)&&a.set(t,e)}for(let e of a.values()){let t=n.findIndex(t=>t.serviceName.toLowerCase()===e.subscription.serviceName?.toLowerCase());t>=0?(n[t]={...n[t],amount:e.subscription.amount||n[t].amount,nextBillingDate:e.subscription.nextBillingDate||n[t].nextBillingDate,lastDetectedAt:e.subscription.lastDetectedAt,hasPdfAttachment:e.subscription.hasPdfAttachment||n[t].hasPdfAttachment,pdfFilenames:e.subscription.pdfFilenames||n[t].pdfFilenames,messageId:e.subscription.messageId||n[t].messageId,attachmentIds:e.subscription.attachmentIds||n[t].attachmentIds,emailSubject:e.subscription.emailSubject||n[t].emailSubject,emailBody:e.subscription.emailBody||n[t].emailBody,senderEmail:e.subscription.senderEmail||n[t].senderEmail,updatedAt:new Date().toISOString()},o++):(n.push(e.subscription),s++)}return{merged:n,newCount:s,updatedCount:o}}e.s(["mergeDetectedSubscriptions",()=>m,"parseEmail",()=>l],22172)}];

//# sourceMappingURL=src_lib_gmail_07c7260b._.js.map